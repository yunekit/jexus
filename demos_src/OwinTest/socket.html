<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>SignalR 测试</title>

    <script src="/Scripts/jquery-3.7.1.min.js"></script>
    <script src="/Scripts/jquery.signalR-2.4.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. 注意：一定别忘记写这句，signalr生成的脚本都在这-->
    <script type="text/javascript" src="/signalr/hubs"></script>

</head>

<body>


    <div id="messageBox" style="margin-bottom:40px">

    </div>


    请输入：<input type="text" id="myMsg"  onkeypress='if(event.keyCode == 13)SendMessage();'/>
    <button onclick='SendMessage();'>发送</button>


    <script type="text/javascript">

        //SignalR的连接对象
        var conn = $.hubConnection();

        //Hub代理：“TestHub”是服务器端写的一个Hub的类名
        var testHub = conn.createHubProxy('TestHub');

        // 定义客户端RecvMessage函数
        // 该函数在服务器端Hub中的体现是“Clients.All.RecvMessage(string message)” 调用
        testHub.on('RecvMessage', function (message) {
            //在页面显示内容
            $("#messageBox").append('<li>' + message + '</li>');

        });

        // 开始连接，并在连接成功后显示内容
        conn.start().done(function () {
            $("#messageBox").append("<strong>SignalR: 与服务器WebSocket连接成功</strong><br/>");
            $('#messageBox').append("<hr/>");
        });

        //发送信息
        function SendMessage() {
            var msg = $('#myMsg').val();
            $('#myMsg').val('').focus();

            //调用TestHub类上的SendMessage方法
            testHub.invoke('SendMessage', msg);

        }

    </script>



</body>
</html>